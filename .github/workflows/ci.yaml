name: CI - Testes Pytest

# O workflow serÃ¡ executado em pushes para 'dev' e 'main', 
# e em Pull Requests (PRs) direcionados a 'dev' e 'main'.
on:
  push:
    branches: [ "dev", "main" ] 
  pull_request:
    branches: [ "dev", "main" ]
  workflow_dispatch: 

jobs:
  build-and-test:
    runs-on: ubuntu-latest # O sistema operacional onde o cÃ³digo serÃ¡ executado

    steps:
    - name: â¬‡ï¸ Checkout do CÃ³digo
      uses: actions/checkout@v4 # Baixa seu cÃ³digo

    - name: ğŸ Configurar Python
      uses: actions/setup-python@v5
      with:
        # Use a versÃ£o do Python que vocÃª estÃ¡ usando localmente (v3.12, conforme seu log)
        python-version: '3.12' 

    - name: ğŸ“¦ Instalar DependÃªncias
      run: |
        python -m pip install --upgrade pip
        # Instala todas as dependÃªncias do seu projeto, incluindo Flask-SQLAlchemy, etc.
        pip install -r requirements.txt
        # Instala ferramentas de teste
        pip install pytest pytest-cov

    - name: ğŸ§ª Rodar Testes com Pytest
      run: |
        # Configura as variÃ¡veis de ambiente necessÃ¡rias (se houver, como SECRET_KEY, etc.)
        # Se vocÃª nÃ£o precisar de variÃ¡veis, pode pular esta parte.
        
        # Executa o pytest. O --cov gera o relatÃ³rio de cobertura.
        pytest --cov=. --cov-report=term
