name: CI - Testes Pytest

# O workflow serÃ¡ executado em pushes para 'dev' e 'main', 
# e em Pull Requests (PRs) direcionados a 'dev' e 'main'.
on:
  push:
    branches: [ "dev", "main" ] 
  pull_request:
    branches: [ "dev", "main" ]
  workflow_dispatch: # Permite execuÃ§Ã£o manual via interface do GitHub

jobs:
  build-and-test:
    runs-on: ubuntu-latest # O sistema operacional onde o cÃ³digo serÃ¡ executado

    steps:
    - name: â¬‡ï¸ Checkout do CÃ³digo
      uses: actions/checkout@v4 # Baixa seu cÃ³digo

    - name: ğŸ Configurar Python
      uses: actions/setup-python@v5
      with:
        # Usando Python 3.12 conforme suas dependÃªncias
        python-version: '3.12' 

    - name: ğŸ“¦ Instalar DependÃªncias e Corrigir Compatibilidade
      run: |
        python -m pip install --upgrade pip
        # 1. Instala todas as dependÃªncias, incluindo a versÃ£o antiga do pytest-flask
        pip install -r requirements.txt
        
        # 2. ForÃ§a a atualizaÃ§Ã£o do pytest-flask e do pytest para versÃµes compatÃ­veis com Flask 3.x
        pip install --upgrade pytest-flask pytest pytest-cov

    - name: ğŸ§ª Rodar Testes com Pytest
      run: |
        # Configura as variÃ¡veis de ambiente necessÃ¡rias (se houver, como SECRET_KEY, etc.)
        
        # Executa o pytest. O --cov gera o relatÃ³rio de cobertura.
        pytest --cov=. --cov-report=term